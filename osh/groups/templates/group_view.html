{% extends 'layout.html' %}

{% block title %}Детали группы{% endblock %}

{% block content %}
    <h1>Детали группы</h1>

    <h2><a href="{{ group.link }}" target="_blank" id="groupLink">Группа {{ group.name }}</a></h2>

    <form id="studentsForm" method="post" action="{{ url_for('students.add_students', group_id=group.id) }}">
        <label for="studentsHtml">HTML-разметка с учениками:</label>
        <textarea id="studentsHtml" name="studentsHtml" rows="1" required></textarea>
        <button type="submit">Добавить студентов</button>
    </form>

    <table>
        <thead>
            <tr>
                <th>Имя ученика</th>
                <th>Заметки по 1-му уроку</th>
                <th>Заметки по 2-му уроку</th>
                <th>Присутствует на уроке</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for student in students %}
                <tr>
                    <td>
                        <a href="{{ url_for('students.view_student', group_id=group.id, student_id=student.id) }}">{{ student.name }}</a>
                    </td>
                    <td>
                        <form method="post" action="{{ url_for('students.update_notes1', group_id=group.id, student_id=student.id) }}">
                            <textarea name="notes_lesson1" rows="2" cols="30">{{ student.notes_lesson1 }}</textarea>
                            <button type="submit">Сохранить</button>
                        </form>
                    </td>
                    <td>
                        <form method="post" action="{{ url_for('students.update_notes2', group_id=group.id, student_id=student.id) }}">
                            <textarea name="notes_lesson2" rows="2" cols="30">{{ student.notes_lesson2 }}</textarea>
                            <button type="submit">Сохранить</button>
                        </form>
                    </td>
                    <td>
                        <span class="presence-indicator {% if student.present %}present{% else %}absent{% endif %}">
                            {{ "" if student.present else "❌"}}
                        </span>
                        {% if student.present == True %}
                            <form method="post" action="{{ url_for('students.mark_absent', group_id=group.id, student_id=student.id) }}">
                                <button type="submit">✅</button>
                            </form>
                        {% endif %}
                    </td>
                    <td>
                        <button onclick="showDeleteConfirmation('{{ student.name }}', {{ student.id }})">Удалить</button>
                        <div id="confirmationModal_{{ student.id }}" class="hidden">
                            <p>Вы уверены, что хотите удалить ученика "{{ student.name }}"?</p>
                            <form method="post" action="{{ url_for('students.delete_student', group_id=group.id, student_id=student.id) }}">
                                <button type="submit">Да, удалить</button>
                                <button type="button" onclick="hideDeleteConfirmation('{{ student.id }}')">Отмена</button>
                            </form>
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <form method="post" action="{{ url_for('students.create_absent_list', group_id=group.id) }}">
        <button type="submit">Создать список отсутствующих</button>
    </form>

    <button onclick="showConfirmationModal()">Удалить группу</button>

    <a href="{{ url_for('groups.list_groups') }}">Назад к списку групп</a>

    <form method="post" action="{{ url_for('students.reset_absent_list', group_id=group.id) }}">
        <button type="submit">Сбросить посещаемость</button>
    </form>

    <div id="confirmationModal" class="hidden">
        <p>Вы уверены, что хотите удалить группу "{{ group.name }}"?</p>
        <form id="deleteForm" method="post" action="{{ url_for('groups.delete_group', group_id=group.id) }}">
            <button type="submit">Да, удалить</button>
            <button type="button" onclick="hideConfirmationModal()">Отмена</button>
        </form>
    </div>
    <script src="{{ url_for('groups.static', filename='js/delete_group.js') }}"></script>

{% endblock %}
