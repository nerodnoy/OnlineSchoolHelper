{% extends 'layout.html' %}

{% block title %}Детали группы{% endblock %}

{% block content %}
    <h1>Детали группы</h1>

    <h3><a href="{{ group.link }}" target="_blank" id="groupLink"> {{ group.name }}</a></h3>

    <form id="studentsForm" method="post" action="{{ url_for('students.add_students', group_id=group.id) }}">
        <label for="studentsHtml">HTML-разметка с учениками:</label>
        <textarea id="studentsHtml" name="studentsHtml" rows="1" required></textarea>
        <button type="submit" class="btn btn-success">Добавить студентов</button>
    </form>

    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Имя ученика</th>
                <th>Заметки по 1-му уроку</th>
                <th>Заметки по 2-му уроку</th>
                <th>Присутствует на уроке</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for student in students %}
                <tr>
                    <td>
                        <a href="{{ url_for('students.view_student', group_id=group.id, student_id=student.id) }}">{{ student.name }}</a>
                    </td>
                    <td>
                        <form method="post" action="{{ url_for('students.update_notes1', group_id=group.id, student_id=student.id) }}">
                            <textarea name="notes_lesson1" rows="2" cols="30">{{ student.notes_lesson1 }}</textarea>
                            <button type="submit">Сохранить</button>
                        </form>
                    </td>
                    <td>
                        <form method="post" action="{{ url_for('students.update_notes2', group_id=group.id, student_id=student.id) }}">
                            <textarea name="notes_lesson2" rows="2" cols="30">{{ student.notes_lesson2 }}</textarea>
                            <button type="submit">Сохранить</button>
                        </form>
                    </td>
                    <td>
                        <span class="presence-indicator {% if student.present %}present{% else %}absent{% endif %}">
                            {{ "" if student.present else "❌"}}
                        </span>
                        {% if student.present == True %}
                            <form method="post" action="{{ url_for('students.mark_absent', group_id=group.id, student_id=student.id) }}">
                                <button type="submit">✅</button>
                            </form>
                        {% endif %}
                    </td>
                    <td>
                            <form method="post" action="{{ url_for('students.delete_student', group_id=group.id, student_id=student.id) }}">
                                <button type="submit">Удалить</button>
                            </form>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <form method="post" action="{{ url_for('students.create_absent_list', group_id=group.id) }}">
        <button type="submit" class="btn btn-success">Создать список отсутствующих</button>
    </form>

    <form method="post" action="{{ url_for('students.reset_absent_list', group_id=group.id) }}">
        <button type="submit" class="btn btn-warning">Сбросить посещаемость</button>
    </form>

    <form method="post" action="{{ url_for('groups.delete_group', group_id=group.id) }}">
        <button class="btn btn-danger">Удалить группу</button>
    </form>

    <form method="get" action="{{ url_for('groups.list_groups') }}">
        <button class="btn btn-primary">Назад к группам</button>
    </form>


    <script src="{{ url_for('groups.static', filename='js/delete_group.js') }}"></script>

{% endblock %}
